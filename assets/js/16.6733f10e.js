(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{211:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_1-实际演练-新证书、新用户和新集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-实际演练-新证书、新用户和新集群"}},[t._v("#")]),t._v(" 1.实际演练:新证书、新用户和新集群")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("生成私钥"),a("code",[t._v("ilinux.crt")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("openssl genrsa -out ilinux.crt "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("生成证书签名请求文件"),a("code",[t._v("ilinux.csr")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("openssl req -new -key ilinux.key -out ilinux.csr -subj "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/CN=ilinux/O=kubeusers"')]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("使用"),a("code",[t._v("k8s")]),t._v("的"),a("code",[t._v("ca.crt")]),t._v("和"),a("code",[t._v("ca.key")]),t._v("进行签名生成证书"),a("code",[t._v("ilinux.crt")]),t._v("，有效期为"),a("code",[t._v("365")]),t._v("天")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 pki"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# openssl x509 -req -in ilinux.csr -CA ./ca.crt -CAkey ./ca.key -CAcreateserial -out ilinux.crt -days 365")]),t._v("\nSignature ok\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("subject")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/CN"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ilinux/O"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("kubeusers\nGetting CA Private Key\n")])])])]),t._v(" "),a("li",[a("p",[t._v("设置新集群（"),a("code",[t._v("mykube")]),t._v("），指明"),a("code",[t._v("apiserver")]),t._v("地址，"),a("code",[t._v("k8s")]),t._v("证书路径和隐藏证书，并保存在（"),a("code",[t._v("/tmp/ilinux.kubeconfig")]),t._v("）")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("kubectl config set-cluster mykube --server"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://192.168.0.104:6443"')]),t._v(" --certificate-authority"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/etc/kubernetes/pki/ca.crt --embed-certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true --kubeconfig"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/tmp/ilinux.kubeconfig\n")])])])]),t._v(" "),a("li",[a("p",[t._v("查看集群,新集群已经创建成功")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl config get-clusters ")]),t._v("\nNAME\nmykube\nkubernetes\n")])])])]),t._v(" "),a("li",[a("p",[t._v("配置新集群权限，自定义权限名为"),a("code",[t._v("ilinux")]),t._v("，其中"),a("code",[t._v("username")]),t._v("需要和"),a("code",[t._v("ilinux.csr")]),t._v("的"),a("code",[t._v("CN")]),t._v("保持一致，"),a("code",[t._v("--embed-certs=true")]),t._v("表示需要打包存放")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("kubectl config set-credentials ilinux --client-certificate"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/etc/kubernetes/pki/ilinux.crt --client-key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/etc/kubernetes/pki/ilinux.key --username"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ilinux --embed-certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true  --kubeconfig"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/tmp/ilinux.kubeconfig\n")])])])]),t._v(" "),a("li",[a("p",[t._v("配置"),a("code",[t._v("context")]),t._v("，并绑定上面设置的新集群名、用户名和自定义权限名，并保存在"),a("code",[t._v("/tmp/ilinux.kubeconfig")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("kubectl config set-context ilinux@mykube --cluster"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mykube --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ilinux  --kubeconfig"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/tmp/ilinux.kubeconfig\n")])])])]),t._v(" "),a("li",[a("p",[t._v("查询当前集群配置信息，发现新集群已经载入，但没有使用，当前读取的配置是"),a("code",[t._v("current-context: kubernetes-admin@kubernetes")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl config view")]),t._v("\napiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data: DATA+OMITTED\n    server: https://192.168.0.104:6443\n  name: kubernetes\n- cluster:\n    certificate-authority-data: DATA+OMITTED\n    server: https://192.168.0.104:6443\n  name: mykube\ncontexts:\n- context:\n    cluster: mykube\n    user: ilinux\n  name: ilinux@mykube\n- context:\n    cluster: kubernetes\n    user: kubernetes-admin\n  name: kubernetes-admin@kubernetes\ncurrent-context: kubernetes-admin@kubernetes\nkind: Config\npreferences: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nusers:\n- name: ilinux\n  user:\n    client-certificate-data: REDACTED\n    client-key-data: REDACTED\n    username: ilinux\n- name: kubernetes-admin\n  user:\n    client-certificate-data: REDACTED\n    client-key-data: REDACTED\n\n")])])])]),t._v(" "),a("li",[a("p",[t._v("切换"),a("code",[t._v("use-context ilinux@mykube")]),t._v("，发现已经没有查询"),a("code",[t._v("pod")]),t._v("的权限了")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 tmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods")]),t._v("\nNAME                     READY   STATUS    RESTARTS   AGE\nngx-new-cb79d555-hfc7h   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          9d\n   \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 tmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl config use-context ilinux@mykube")]),t._v("\nSwitched to context "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ilinux@mykube"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 tmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods")]),t._v("\nError from server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Forbidden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": pods is forbidden: User "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ilinux"')]),t._v(" cannot list resource "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pods"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" API group "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the namespace "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default"')]),t._v("\n\n")])])])]),t._v(" "),a("li",[a("p",[t._v("这时候，再切换成管理员账号，发现一切正常")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 tmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl config use-context         kubernetes-admin@kubernetes")]),t._v("\nSwitched to context "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubernetes-admin@kubernetes"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 tmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods")]),t._v("\nNAME                     READY   STATUS    RESTARTS   AGE\nngx-new-cb79d555-hfc7h   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          9d\n\n")])])])]),t._v(" "),a("li",[a("p",[t._v("我们还可以使用，位置参数的方式，使用自定义配置文件进行用户权限的切换")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 tmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl config view --kubeconfig=/tmp/ilinux.kubeconfig")]),t._v("\napiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data: DATA+OMITTED\n    server: https://192.168.0.104:6443\n  name: mykube\ncontexts:\n- context:\n    cluster: mykube\n    user: ilinux\n  name: ilinux@mykube\ncurrent-context: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\nkind: Config\npreferences: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nusers:\n- name: ilinux\n  user:\n    client-certificate-data: REDACTED\n    client-key-data: REDACTED\n    username: ilinux\n    \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 tmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl config use-context ilinux@mykube --kubeconfig=/tmp/ilinux.kubeconfig")]),t._v("\nSwitched to context "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ilinux@mykube"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n    \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 tmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods --kubeconfig=/tmp/ilinux.kubeconfig")]),t._v("\nError from server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Forbidden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": pods is forbidden: User "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ilinux"')]),t._v(" cannot list resource "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pods"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" API group "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the namespace "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 tmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods ")]),t._v("\nNAME                     READY   STATUS    RESTARTS   AGE\nngx-new-cb79d555-hfc7h   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          9d\n\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"_2-rbac"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-rbac"}},[t._v("#")]),t._v(" 2.RBAC")]),t._v(" "),a("p",[t._v("官方文档：")]),t._v(" "),a("p",[t._v("https://kubernetes.io/docs/reference/access-authn-authz/rbac/")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("授权模型")]),t._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("基于节点：\n    Node：专用的授权插件，根据Pod对象调度的结果为Node进行授权\n    \n基于用户：\n    ABAC：1.17之前的策略，新版本已经默认使用RBAC\n    RBAC：赋予某个角色对于某个资源进行某种操作，其中角色可以是人也可以是组\n其他：\n    Webhook\n")])])])]),t._v(" "),a("li",[a("p",[t._v("当前"),a("code",[t._v("K8s")]),t._v("集群采用的集群策略查看("),a("code",[t._v("Node+RBAC")]),t._v(")")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 chapter10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat /etc/kubernetes/manifests/kube-apiserver.yaml ")]),t._v("\napiVersion: v1\nkind: Pod\nmetadata:\n  creationTimestamp: null\n  labels:\n    component: kube-apiserver\n    tier: control-plane\n  name: kube-apiserver\n  namespace: kube-system\nspec:\n  containers:\n  - command:\n    - kube-apiserver\n    - --advertise-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.104\n    - --allow-privileged"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\n    - --authorization-mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Node,RBAC\n\n")])])])]),t._v(" "),a("li",[a("p",[t._v("相关命令")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#名称空间级别权限和绑定")]),t._v("\nkubectl explain role  \nkubectl explain rolebinding\n   \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#集群级别权限和绑定")]),t._v("\nkubectl explain ClusterRole  \nkubectl explain ClusterRoleBinding\n   \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#策略详情查看")]),t._v("\nkubectl get role  view -o yaml\nkubectl get clusterrole  view -o yaml\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"_3-常用策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-常用策略"}},[t._v("#")]),t._v(" 3.常用策略")]),t._v(" "),a("p",[t._v("（以下所有操作都基于上面创建的"),a("code",[t._v("ilinux")]),t._v("用户进行，并且每个操作之前需要删除之前配置过的权限\n，否则会相互影响）")]),t._v(" "),a("h3",{attrs:{id:"_1-role-rolebinding"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-role-rolebinding"}},[t._v("#")]),t._v(" 1.Role+RoleBinding")]),t._v(" "),a("p",[t._v("正常使用：某个名称空间级别的权限授权")]),t._v(" "),a("ul",[a("li",[t._v("编辑"),a("code",[t._v("role：res-reader.yaml")])])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Role             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#名称空间权限")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#只能读取default名称空间下的对应规则")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reader\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# "" 表示核心群组：core API group')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pods"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pods/log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"services"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"get"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"list"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"watch"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("ul",[a("li",[t._v("编辑"),a("code",[t._v("rolebinding：ilinux-res-reader.yaml")])])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RoleBinding                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#名称空间级别权限绑定;ClusterRoleBinding为集群级别的权限绑定")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ilinux"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reader                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#增加可读性，命名规则：<用户>-<权限>")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subjects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" User\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ilinux\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Role\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reader\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n")])])]),a("ul",[a("li",[t._v("依次"),a("code",[t._v("apply")]),t._v("配置文件，发现"),a("code",[t._v("ilinux")]),t._v("用户至在"),a("code",[t._v("default")]),t._v("名称空间下有对应"),a("code",[t._v("pods")]),t._v(", "),a("code",[t._v("pods/log")]),t._v(", "),a("code",[t._v("services")]),t._v("的对应权限，和预期一样")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 RBAC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pod --kubeconfig=/tmp/ilinux.kubeconfig ")]),t._v("\nNAME                     READY   STATUS    RESTARTS   AGE\nngx-new-cb79d555-hfc7h   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          10d\n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 RBAC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get service --kubeconfig=/tmp/ilinux.kubeconfig")]),t._v("\nNAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   AGE\nkubernetes   ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.96")]),t._v(".0.1    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("/TCP   11d\n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 RBAC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get service --kubeconfig=/tmp/ilinux.kubeconfig -n ingress-nginx")]),t._v("\nError from server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Forbidden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": services is forbidden: User "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ilinux"')]),t._v(" cannot list resource "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"services"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" API group "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the namespace "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ingress-nginx"')]),t._v("\n")])])]),a("h3",{attrs:{id:"_2-clusterrole-clusterrolebinding"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-clusterrole-clusterrolebinding"}},[t._v("#")]),t._v(" 2.ClusterRole+ClusterRoleBinding")]),t._v(" "),a("p",[t._v("正常使用：k8s集群级别的权限授权")]),t._v(" "),a("ul",[a("li",[t._v("编辑"),a("code",[t._v("ClusterRole：cluster-res-reader.yaml")])])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRole             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#集群范围权限")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reader\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# "" 表示核心群组：core API group')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pods"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pods/log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"services"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"get"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"list"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"watch"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n")])])]),a("ul",[a("li",[t._v("编辑"),a("code",[t._v("ClusterRoleBinding：cluster-ilinux-res-reader.yaml")])])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRoleBinding                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ClusterRoleBinding为集群级别的权限绑定")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ilinux"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reader                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#增加可读性，命名规则：<用户>-<权限>")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subjects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" User\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ilinux\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRole\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reader\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n")])])]),a("ul",[a("li",[t._v("依次"),a("code",[t._v("apply")]),t._v("配置文件，并通过以下命令观察权限生成情况")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 RBAC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get clusterrole")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 RBAC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get clusterrolebinding")]),t._v("\n")])])]),a("ul",[a("li",[t._v("这时，我们发现"),a("code",[t._v("ilinux")]),t._v("用户已经具有集群级别（所有名称空间）的对应权限")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 RBAC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get service --kubeconfig=/tmp/ilinux.kubeconfig -n ingress-nginx")]),t._v("\nNAME                       TYPE       CLUSTER-IP      EXTERNAL-IP   PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                      AGE\nnginx-ingress-controller   NodePort   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.99")]),t._v(".160.254   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(":30080/TCP,443:30443/TCP   26h\n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 RBAC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get service --kubeconfig=/tmp/ilinux.kubeconfig ")]),t._v("\nNAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   AGE\nkubernetes   ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.96")]),t._v(".0.1    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("/TCP   11d\n")])])]),a("h3",{attrs:{id:"_3-clusterrole-rolebinding"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-clusterrole-rolebinding"}},[t._v("#")]),t._v(" 3.ClusterRole+RoleBinding")]),t._v(" "),a("p",[t._v("交叉使用：其中"),a("code",[t._v("ClusterRole")]),t._v("策略会降级成"),a("code",[t._v("rolebinding")]),t._v("名称空间的策略，效果和"),a("code",[t._v("role+rolebinding")]),t._v("一样，\n好处就是在名称空间很多的时候，重复权限的配置文件会少一半，而且更灵活")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("使用上面的"),a("code",[t._v("ClusterRole")]),t._v("（"),a("code",[t._v("cluster-res-reader.yaml")]),t._v("），并"),a("code",[t._v("apply-f")])])]),t._v(" "),a("li",[a("p",[t._v("编辑"),a("code",[t._v("rolebinding")]),t._v("："),a("code",[t._v("cluster-default-ilinux-res-reader.yaml")])])])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RoleBinding                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#名称空间级别权限绑定;ClusterRoleBinding为集群级别的权限绑定")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ilinux"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reader                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#增加可读性，命名规则：<用户>-<权限>")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subjects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" User\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ilinux\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRole\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reader\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io    \n")])])]),a("ul",[a("li",[t._v("测试和预期一样，"),a("code",[t._v("ClusterRole")]),t._v("降级成"),a("code",[t._v("default")]),t._v("名称空间的权限了")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1 RBAC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get service --kubeconfig=/tmp/ilinux.kubeconfig ")]),t._v("\nNAME         TYPE        CLUSTER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("IP   EXTERNAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("IP   PORT(S)   AGE\nkubernetes   ClusterIP   10.96.0.1    <none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("        443/TCP   11d\n    \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1 RBAC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get service --kubeconfig=/tmp/ilinux.kubeconfig  -n ingress-nginx")]),t._v("\nError from server (Forbidden)"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" services is forbidden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' User "ilinux" cannot list resource "services" in API group "" in the namespace "ingress'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('nginx"\n')])])])])}),[],!1,null,null,null);s.default=e.exports}}]);