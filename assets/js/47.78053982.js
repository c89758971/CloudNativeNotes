(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{218:function(t,s,a){"use strict";a.r(s);var r=a(0),n=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"envoy配置方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#envoy配置方式"}},[t._v("#")]),t._v(" Envoy配置方式")]),t._v(" "),a("p",[t._v("Envoy的架构支持非常灵活的配置方式：简单部署场景可以使用纯静态配置，\n而更复杂的部署场景则可以逐步添加需要的动态配置机制")]),t._v(" "),a("ul",[a("li",[t._v("基础概念")]),t._v(" "),a("li",[t._v("Upstream clusters")])]),t._v(" "),a("h2",{attrs:{id:"_1-基础概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-基础概念"}},[t._v("#")]),t._v(" 1.基础概念")]),t._v(" "),a("p",[a("code",[t._v("Bootstrap")]),t._v("配置中几个重要的基础概念：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"node"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{...}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"static_resources"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{...}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"dynamic_resources"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{...}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"cluster_manager"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{...}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hds_config"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{...}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"flags_path"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"stats_sinks"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"stats_config"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{...}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"stats_flush_interval"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{...}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"watchdog"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{...}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"tracing"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{...}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"runtime"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{...}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"layered_runtime"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{...}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"admin"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{...}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"overload_manager"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{...}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"enable_dispatcher_stats"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"header_prefix"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("node：节点标识，以呈现给管理服务器并且例如用于标识目的；")]),t._v(" "),a("li",[t._v("static_resources：静态配置的资源，用于配置静态的listener、cluster\n和secret；")]),t._v(" "),a("li",[t._v("dynamic_resources：动态配置的资源，用于配置基于xDS API获取\nlistener、cluster和secret配置的lds_config、cds_config和ads_config；")]),t._v(" "),a("li",[t._v("admin：Envoy内置的管理接口；")]),t._v(" "),a("li",[t._v("tracing：分布式跟踪；")]),t._v(" "),a("li",[t._v("layered_runtime：层级化的运行时，支持使用RTDS从管理服务器\n动态加载；")]),t._v(" "),a("li",[t._v("hds_config：使用HDS从管理服务器加载上游主机健康状态检测相关的配置；")]),t._v(" "),a("li",[t._v("overload_manager：过载管理器；")]),t._v(" "),a("li",[t._v("stats_sinks：统计信息接收器；")])]),t._v(" "),a("p",[t._v("一般来说，侦听器和集群是最为常用基础配置，无论是以静态 或者是动态方式提供")]),t._v(" "),a("h2",{attrs:{id:"_2-upstream-clusters"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-upstream-clusters"}},[t._v("#")]),t._v(" 2.Upstream clusters")]),t._v(" "),a("p",[a("code",[t._v("Envoy")]),t._v("可配置任意数量的上游集群，并使用"),a("code",[t._v("Cluster Manager")]),t._v("进行管理；")]),t._v(" "),a("ul",[a("li",[t._v("由集群管理器负责管理的各集群可以由用户静态配置，也可借助于"),a("code",[t._v("CDS API")]),t._v("动 态获取；")]),t._v(" "),a("li",[t._v("集群中的每个成员由"),a("code",[t._v("endpoint")]),t._v("进行标识，它可由用户静态配置，也可通过"),a("code",[t._v("EDS")]),t._v("或 "),a("code",[t._v("DN")]),t._v("S服务动态发现；\n"),a("ul",[a("li",[t._v("Static：静态配置")]),t._v(" "),a("li",[t._v("Strict DNS：严格DNS，Envoy将持续和异步地解析指定的DNS目标，\n并将DNS结果中的返回的每个IP地址视为上游集群中可用成员；")]),t._v(" "),a("li",[t._v("Logical DNS：逻辑DNS，集群仅使用在需要启动新连接时返回的第一个IP地址，\n而非严格获取DNS查询的结果并假设它们构成整个上游集群；适用于必须通过DNS访问的大规模Web服务集群；")]),t._v(" "),a("li",[t._v("Originaldestination：当传入连接通过iptables的REDIRECT或TPROXYtarget或使用代理协议重定向到Envoy时，\n可以使用原始目标集群；")]),t._v(" "),a("li",[t._v("Endpoint discovery service (EDS)：EDS是一种基于GRPC或REST-JSON API的xDS管理服务器获取集群成员的服务发现方式；")]),t._v(" "),a("li",[t._v("Custom cluster：Envoy还支持在集群配置上的cluster_type字段中指定使用自定义集群发现机制；")])])])])])}),[],!1,null,null,null);s.default=n.exports}}]);