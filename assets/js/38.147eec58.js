(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{224:function(a,t,s){"use strict";s.r(t);var e=s(0),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"prometheus"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prometheus"}},[a._v("#")]),a._v(" Prometheus")]),a._v(" "),s("p",[a._v("云原生体系下，你可以使用"),s("code",[a._v("operator")]),a._v("、"),s("code",[a._v("helm")]),a._v("、"),s("code",[a._v("kube")]),a._v("三种方式进行更好的管理"),s("code",[a._v("prometheus")]),a._v("。\n本章节仅使用了最简单的yaml的方式进行部署，为了支撑"),s("code",[a._v("Istio")]),a._v("章节的演示说明所需。\n你也可以把这些"),s("code",[a._v("yaml")]),a._v("封装成helm的charts进行管理")]),a._v(" "),s("ul",[s("li",[a._v("Prometheus、Grafana部署")]),a._v(" "),s("li",[a._v("Grafana配置")])]),a._v(" "),s("h2",{attrs:{id:"_1-prometheus、grafana部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-prometheus、grafana部署"}},[a._v("#")]),a._v(" 1.Prometheus、Grafana部署")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("组件")]),a._v(" "),s("th",[a._v("访问地址")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("prometheus")]),a._v(" "),s("td",[a._v("192.168.0.114:30003")])]),a._v(" "),s("tr",[s("td",[a._v("grafana")]),a._v(" "),s("td",[a._v("192.168.0.114:31759/login")])]),a._v(" "),s("tr",[s("td",[a._v("grafana-ingress")]),a._v(" "),s("td",[a._v("k8s.grafana:31759/login")])])])]),a._v(" "),s("p",[a._v("本小节除了提供常规的NodePort访问类型外，还提供了"),s("code",[a._v("ingress")]),a._v("配置，如果想使用"),s("code",[a._v("ingress")]),a._v("访问，你需要提前集成好"),s("code",[a._v("ingress-controllers")]),a._v("，\n具体配置详见："),s("a",{attrs:{href:"https://github.com/Aaron1989/CloudNativeNotes/tree/master/Kubernetes/11.Ingress%E8%B5%84%E6%BA%90",target:"_blank",rel:"noopener noreferrer"}},[a._v("Kubernetes/11.ingress资源"),s("OutboundLink")],1)]),a._v(" "),s("ol",[s("li",[a._v("部署方式，请按照本章节提供的配置文件，按一下顺序"),s("code",[a._v("apply")]),a._v("就行，默认配置的"),s("code",[a._v("ns")]),a._v("在"),s("code",[a._v("kube-system")])])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#安装node-exporter")]),a._v("\nkubectl apply -f  node-exporter.yaml \n    \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#安装prometheus组件")]),a._v("\nkubectl apply -f  prometheus/rbac-setup.yaml\nkubectl apply -f  prometheus/configmap.yaml \nkubectl apply -f  prometheus/prometheus.deploy.yml \nkubectl apply -f  prometheus/prometheus.svc.yml \n    \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#安装 grafana 组件")]),a._v("\nkubectl apply -f   grafana/grafana-deploy.yaml\nkubectl apply -f   grafana/grafana-svc.yaml\nkubectl apply -f   grafana/grafana-ingress.yaml\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[a._v("此时你可以看到相关信息，如下所示")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@k8s-etcd-mater01 grafana"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# kubectl get svc -n kube-system")]),a._v("\nNAME            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("S"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("                  AGE\ngrafana         NodePort    "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.96")]),a._v(".134.177   "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3000")]),a._v(":31759/TCP           46m\nkube-dns        ClusterIP   "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.96")]),a._v(".0.10      "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("53")]),a._v("/UDP,53/TCP,9153/TCP   3d23h\nnode-exporter   NodePort    "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.109")]),a._v(".54.128   "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9100")]),a._v(":31672/TCP           51m\nprometheus      NodePort    "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.98")]),a._v(".188.149   "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9090")]),a._v(":30003/TCP           49m\n    \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@k8s-etcd-mater01 grafana"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# kubectl get ingress -n kube-system")]),a._v("\nNAME      HOSTS         ADDRESS   PORTS   AGE\ngrafana   k8s.grafana             "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("      46m\n\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[a._v("此时你已经可以访问相关页面了")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#prometheus")]),a._v("\nhttp://192.168.0.114:30003\n    \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#grafana（默认用户密码 admin admin）")]),a._v("\nhttp://192.168.0.114:31759/login\n    \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#grafana-ingress（默认用户密码 admin admin），你需要自行配置好hosts文件或者DNS解析    ")]),a._v("\nhttp://k8s.grafana:31759/login    \n")])])]),s("h2",{attrs:{id:"_2-grafana配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-grafana配置"}},[a._v("#")]),a._v(" 2.Grafana配置")]),a._v(" "),s("ol",[s("li",[a._v("配置"),s("code",[a._v("prometheus数")]),a._v("据源，并设置成default（略）")]),a._v(" "),s("li",[a._v("导入"),s("code",[a._v("dashboard")]),a._v("面板，配置模版的序号为"),s("code",[a._v("315")]),a._v(" "),s("img",{attrs:{src:"https://github-aaron89.oss-cn-beijing.aliyuncs.com/istio/grafana-dashboard-import.png",alt:"grafana-dashboard-import"}})]),a._v(" "),s("li",[a._v("此时一个基础且较完善的k8s集群监控图也已经出来了\n"),s("img",{attrs:{src:"https://github-aaron89.oss-cn-beijing.aliyuncs.com/istio/grafana-dashboard.png",alt:"grafana-dashboard"}})])])])}),[],!1,null,null,null);t.default=r.exports}}]);