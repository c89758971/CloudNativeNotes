(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{207:function(t,s,n){"use strict";n.r(s);var a=n(0),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"envoy使用入门-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#envoy使用入门-3"}},[t._v("#")]),t._v(" Envoy使用入门_3")]),t._v(" "),n("p",[t._v("本章节首先阐述"),n("code",[t._v("L4")]),t._v("过滤器"),n("code",[t._v("http_connection_manage")]),t._v("r和"),n("code",[t._v("egress")]),t._v("代理配置说明，然后使用2个完善的例子，\n让你充分了解"),n("code",[t._v("http_connection_manager")]),t._v("于"),n("code",[t._v("egress")]),t._v("和"),n("code",[t._v("ingress")]),t._v("中的使用情况。")]),t._v(" "),n("ul",[n("li",[t._v("L4过滤器http_connection_manager")]),t._v(" "),n("li",[t._v("Egress代理配置示例")]),t._v(" "),n("li",[t._v("Egress实战")]),t._v(" "),n("li",[t._v("Ingress实战")])]),t._v(" "),n("h2",{attrs:{id:"_1-l4过滤器http-connection-manager"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-l4过滤器http-connection-manager"}},[t._v("#")]),t._v(" 1.L4过滤器http_connection_manager")]),t._v(" "),n("p",[n("code",[t._v("http_connection_manager")]),t._v("通过引入"),n("code",[t._v("L7")]),t._v("过滤器链实现了对"),n("code",[t._v("http")]),t._v("协议的操纵， 其中"),n("code",[t._v("router")]),t._v("过滤器用于配置路由转发")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("listeners")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("socket_address")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port_value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filter_chains")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filters")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envoy.http_connection_manager\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("condec_type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 连接管理器使用的编解码器类型，可用值有AUTO、HTTP1和HTTP2；")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stat_prefix")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 统计信息中使用的易读性的信息前缀；")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route_config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 静态路由配置；动态配置应该使用rds字段进行指定；")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 路由配置的名称；")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("virtual_hosts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 虚拟主机列表，用于构成路由表；")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 虚拟主机的逻辑名称，用于统计信息，与路由无关；")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("domains")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当前虚拟主机匹配的域名列表，支持使用“*”通配符；匹配搜索次序为精确匹配、前缀通配、后缀通配及完全通配；")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 路由列表，按顺序搜索，第一个匹配到路由信息；")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http_filters")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 定义http过滤器链")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envoy.router "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 调用的过滤器为envoy.router")]),t._v("\n")])])]),n("p",[t._v("注意：")]),t._v(" "),n("ul",[n("li",[t._v("处理请求时，"),n("code",[t._v("Envoy")]),t._v("首先根据下游客户端请求的"),n("code",[t._v("host")]),t._v("来搜索虚拟主机列表中各"),n("code",[t._v("virtual_host")]),t._v("中的"),n("code",[t._v("domains")]),t._v("列表中的定义，第一个匹配到的"),n("code",[t._v("Domain")]),t._v("的定义所属的"),n("code",[t._v("virtual_host")]),t._v("即可处理请求的虚拟主机；")]),t._v(" "),n("li",[t._v("而后搜索当前虚拟主机中的"),n("code",[t._v("routes")]),t._v("列表中的路由列表中各路由条目的"),n("code",[t._v("match")]),t._v("的定义，第一个匹配到的"),n("code",[t._v("match")]),t._v("后的路由机制（"),n("code",[t._v("route")]),t._v("、"),n("code",[t._v("redirect")]),t._v("或"),n("code",[t._v("direct_response")]),t._v("）即生效；")])]),t._v(" "),n("h2",{attrs:{id:"_2-egress代理配置示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-egress代理配置示例"}},[t._v("#")]),t._v(" 2.Egress代理配置示例")]),t._v(" "),n("p",[t._v("下面是一个"),n("code",[t._v("egress")]),t._v("类型的"),n("code",[t._v("Envoy")]),t._v("配置示例，它定义了两个"),n("code",[t._v("virtual_host")]),t._v("，不过，发往第二个"),n("code",[t._v("virtual_host")]),t._v("的请求将被重定向至第一个"),n("code",[t._v("virtual_hosts：web_service_1")])]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("listeners")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" listener_0\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("socket_address")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 127.0.0.1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port_value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80 ")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filter_chains")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filters")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envoy.http_connection_manager\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stat_prefix")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" egress_http\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("codec_type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" AUTO\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route_config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test_route\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("virtual_hosts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web_service_1\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("domains")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*.ik8s.io"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ik8s.io"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefix")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web_cluster_1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web_service_2\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("domains")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*.k8scast.cn"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"k8scast.cn"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefix")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redirect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host_redirect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"www.ik8s.io"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http_filters")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envoy.router\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("clusters")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n")])])]),n("h2",{attrs:{id:"_3-egress实战"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-egress实战"}},[t._v("#")]),t._v(" 3.Egress实战")]),t._v(" "),n("p",[t._v("需要提前配置好"),n("code",[t._v("ip_forward")]),t._v("：")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("sysctl -w net.ipv4.ip_forward"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:"https://github-aaron89.oss-cn-beijing.aliyuncs.com/istio/egress-http_connection_manager.png",alt:"egress-1"}})]),t._v(" "),n("p",[t._v("你需要先读懂这张图，本小结准备用"),n("code",[t._v("curl")]),t._v("模拟"),n("code",[t._v("Sidecar")]),t._v("模式下"),n("code",[t._v("egress")]),t._v("的工作逻辑，并借用内建的"),n("code",[t._v("filter(http_connection_manager)")]),t._v("进行代理。")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("将"),n("code",[t._v("egress")]),t._v("目录下的配置文件拉取到本地，并使用"),n("code",[t._v("docker-compose up")]),t._v("。\n所有需要注意的地方，已经在配置文件中进行了注释")])]),t._v(" "),n("li",[n("p",[t._v("注意业务容器"),n("code",[t._v("ID")]),t._v("，下面测试会"),n("code",[t._v("echo")]),t._v("出来，用于检测。\n进入"),n("code",[t._v("egress_envoy_1")]),t._v("容器的交互式接口，准备测试")])])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("CONTAINER ID        IMAGE                               COMMAND                  CREATED             STATUS              PORTS               NAMES\n2771ccb25e01        egress_envoy                        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/docker-entrypoint.…"')]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(" seconds ago      Up "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(" seconds       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v("/tcp           egress_envoy_1\nbdd457740567        ikubernetes/mini-http-server:v0.3   "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/httpserver"')]),t._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" seconds ago      Up "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(" seconds       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),t._v("/tcp            egress_webserver1_1\na9273da1f539        ikubernetes/mini-http-server:v0.3   "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/httpserver"')]),t._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" seconds ago      Up "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(" seconds       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),t._v("/tcp            egress_webserver2_1\n    \n    \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-etcd-mater01 tcpproxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker exec -it egress_envoy_1 /bin/sh")]),t._v("\n/ "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ifconfig ")]),t._v("\neth0      Link encap:Ethernet  HWaddr 02:42:AC:13:00:04  \n          inet addr:172.19.0.4  Bcast:172.19.255.255  Mask:255.255.0.0\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:17 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:21 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0 \n          RX bytes:1794 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.7")]),t._v(" KiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  TX bytes:1554 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.5")]),t._v(" KiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \nlo        Link encap:Local Loopback  \n          inet addr:127.0.0.1  Mask:255.0.0.0\n          UP LOOPBACK RUNNING  MTU:65536  Metric:1\n          RX packets:15 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:15 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0 \n          RX bytes:898 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("898.0")]),t._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  TX bytes:898 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("898.0")]),t._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n/ "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# netstat -tnlp")]),t._v("\nActive Internet connections "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("only servers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    \ntcp        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.11:42955        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      -\ntcp        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:80            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/envoy\n\n")])])]),n("ol",{attrs:{start:"3"}},[n("li",[t._v("根据我们的预研，分别进行"),n("code",[t._v("curl")]),t._v("测试，发现跳转结果和预期一样，配置成功")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("/ "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# curl -H "host: www.ik8s.io" 127.0.0.1/hostname')]),t._v("\nHostname: bdd457740567.              "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#webserver1")]),t._v("\n    \n/ "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# curl -H "host: www.k8scast.cn" 127.0.0.1/hostname')]),t._v("\nHostname: a9273da1f539.              "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#webserver2")]),t._v("\n    \n/ "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# curl -H "host: www.k8sall.cn" 127.0.0.1/hostname')]),t._v("\nHostname: bdd457740567.             "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#webserver1")]),t._v("\n/ "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# curl -H "host: www.k8sall.cn" 127.0.0.1/hostname')]),t._v("\nHostname: a9273da1f539.             "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#webserver2")]),t._v("\n    \n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -H "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host: www.k8stest.com"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1/hostname\nHostname: bdd457740567.            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#webserver1")]),t._v("\n\n")])])]),n("h2",{attrs:{id:"_4-ingress实战"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-ingress实战"}},[t._v("#")]),t._v(" 4.Ingress实战")]),t._v(" "),n("ol",[n("li",[t._v("所有配置文件，请看"),n("code",[t._v("ingress")]),t._v("目录下（关键字段，我已经给了注释），此时你应该较容易看懂，\n然后使用"),n("code",[t._v("docker-compose up")])])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-etcd-mater01 ingress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker-compose up")]),t._v("\nCreating network "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ingress_envoymesh"')]),t._v(" with the default driver\nCreating ingress_mainserver_1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\nCreating ingress_envoy_1      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\nAttaching to ingress_mainserver_1, ingress_envoy_1\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.246"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/server.cc:238"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" initializing epoch "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hot restart "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("version")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11.104")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.247"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/server.cc:240"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" statically linked extensions:\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.247"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/server.cc:242"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("   access_loggers: envoy.file_access_log,envoy.http_grpc_access_log\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.247"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/server.cc:245"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("   filters.http: envoy.buffer,envoy.cors,envoy.csrf,envoy.ext_authz,envoy.fault,envoy.filters.http.dynamic_forward_proxy,envoy.filters.http.grpc_http1_reverse_bridge,envoy.filters.http.header_to_metadata,envoy.filters.http.jwt_authn,envoy.filters.http.original_src,envoy.filters.http.rbac,envoy.filters.http.tap,envoy.grpc_http1_bridge,envoy.grpc_json_transcoder,envoy.grpc_web,envoy.gzip,envoy.health_check,envoy.http_dynamo_filter,envoy.ip_tagging,envoy.lua,envoy.rate_limit,envoy.router,envoy.squash\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.247"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/server.cc:248"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("   filters.listener: envoy.listener.original_dst,envoy.listener.original_src,envoy.listener.proxy_protocol,envoy.listener.tls_inspector\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.247"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/server.cc:251"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("   filters.network: envoy.client_ssl_auth,envoy.echo,envoy.ext_authz,envoy.filters.network.dubbo_proxy,envoy.filters.network.mysql_proxy,envoy.filters.network.rbac,envoy.filters.network.sni_cluster,envoy.filters.network.thrift_proxy,envoy.filters.network.zookeeper_proxy,envoy.http_connection_manager,envoy.mongo_proxy,envoy.ratelimit,envoy.redis_proxy,envoy.tcp_proxy\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.247"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/server.cc:253"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("   stat_sinks: envoy.dog_statsd,envoy.metrics_service,envoy.stat_sinks.hystrix,envoy.statsd\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.247"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/server.cc:255"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("   tracers: envoy.dynamic.ot,envoy.lightstep,envoy.tracers.datadog,envoy.tracers.opencensus,envoy.zipkin\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.247"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/server.cc:258"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("   transport_sockets.downstream: envoy.transport_sockets.alts,envoy.transport_sockets.tap,raw_buffer,tls\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.247"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/server.cc:261"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("   transport_sockets.upstream: envoy.transport_sockets.alts,envoy.transport_sockets.tap,raw_buffer,tls\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.247"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/server.cc:267"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" buffer implementation: old "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("libevent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.254"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("warning"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/server.cc:327"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" No admin address given, so no admin HTTP server started.\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.256"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/server.cc:432"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" runtime: layers:\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   - name: base\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     static_layer:\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   - name: admin\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     admin_layer:\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.256"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("warning"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("runtime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/common/runtime/runtime_impl.cc:497"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Skipping unsupported runtime layer: name: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"base"')]),t._v("\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" static_layer "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" \nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.256"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/configuration_impl.cc:61"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" loading "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" static secret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.256"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/configuration_impl.cc:67"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" loading "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.261"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upstream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/common/upstream/cluster_manager_impl.cc:148"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" cm init: all clusters initialized\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.261"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/configuration_impl.cc:71"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" loading "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" listener"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.263"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/configuration_impl.cc:96"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" loading tracing configuration\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.263"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/configuration_impl.cc:116"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" loading stats sink configuration\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.263"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/server.cc:500"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" all clusters initialized. initializing init manager\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.263"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/listener_manager_impl.cc:761"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" all dependencies initialized. starting workers\nenvoy_1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-12-26 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":28:31.264"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("source/server/server.cc:516"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" starting main dispatch loop\n\n")])])]),n("ol",{attrs:{start:"2"}},[n("li",[t._v("进入"),n("code",[t._v("ingress_envoy_1")]),t._v("容器交互式接口，获知"),n("code",[t._v("ip")]),t._v("地址")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-etcd-mater01 egress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker exec -it ingress_envoy_1 /bin/sh")]),t._v("\n/ "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ifconfig ")]),t._v("\neth0      Link encap:Ethernet  HWaddr 02:42:AC:14:00:02  \n          inet addr:172.20.0.2  Bcast:172.20.255.255  Mask:255.255.0.0\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:32 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:2 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0 \n          RX bytes:4528 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.4")]),t._v(" KiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  TX bytes:180 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("180.0")]),t._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \nlo        Link encap:Local Loopback  \n          inet addr:127.0.0.1  Mask:255.0.0.0\n          UP LOOPBACK RUNNING  MTU:65536  Metric:1\n          RX packets:0 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0 \n          RX bytes:0 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  TX bytes:0 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),n("ol",{attrs:{start:"3"}},[n("li",[t._v("退出容器，使用"),n("code",[t._v("curl")]),t._v("命令，探测"),n("code",[t._v("ingress_envoy_1")]),t._v("容器的80端口；和预期一致，配置成功")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-etcd-mater01 egress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# curl 172.20.0.2")]),t._v("\nThis is a website server by a Go HTTP server.\n    \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-etcd-mater01 egress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# curl 172.20.0.2/hostname")]),t._v("\nHostname: 43e46c0f245e.\n\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);