(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{246:function(t,a,s){"use strict";s.r(a);var e=s(0),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"taints-and-tolerations（污点和容忍度）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#taints-and-tolerations（污点和容忍度）"}},[t._v("#")]),t._v(" Taints and Tolerations（污点和容忍度）")]),t._v(" "),s("p",[t._v("Taint（污点）和Toleration（容忍）可以作用于node和pod上，其目的是优化pod在集群间的调度，这跟节点亲和性类似，\n只不过它们作用的方式相反，用作确保pod不会被调度在指定的节点上")]),t._v(" "),s("ul",[s("li",[t._v("概念引入")]),t._v(" "),s("li",[t._v("Taints Effect")]),t._v(" "),s("li",[t._v("How to match?")]),t._v(" "),s("li",[t._v("Taint based Evictions")]),t._v(" "),s("li",[t._v("常用命令")]),t._v(" "),s("li",[t._v("实战操作")]),t._v(" "),s("li",[t._v("参考文档")])]),t._v(" "),s("h2",{attrs:{id:"_1-概念引入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-概念引入"}},[t._v("#")]),t._v(" 1.概念引入")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://github-aaron89.oss-cn-beijing.aliyuncs.com/Kubernetes/taints.png",alt:"taints"}})]),t._v(" "),s("p",[t._v("如图所示，"),s("code",[t._v("node")]),t._v("节点上分别有云、五角星、十字架这三个污点；"),s("code",[t._v("Pod-A")]),t._v("上有云和五角星的污点容忍度，"),s("code",[t._v("Pod—B")]),t._v("上则没有\n容忍度。")]),t._v(" "),s("p",[t._v("调度结果：")]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Pod-A：调度至node-1和node-3\nPod-B: 只会调度至node-3\n注意：Taints存在于node，Tolerations存在于pod\n")])])]),s("h2",{attrs:{id:"_2-taints-effect"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-taints-effect"}},[t._v("#")]),t._v(" 2.Taints Effect")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("参数")]),t._v(" "),s("th",[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("key")]),t._v(" "),s("td",[t._v("string类型，最大长度253个字符，必须小写或数字开头")])]),t._v(" "),s("tr",[s("td",[t._v("value")]),t._v(" "),s("td",[t._v("string类型，最大长度63个字符，必须小写或数字开头")])]),t._v(" "),s("tr",[s("td",[t._v("effect:Noschedule")]),t._v(" "),s("td",[t._v("1.不允许非法pod调度上来。2.taints变更，不会驱离非法的pod")])]),t._v(" "),s("tr",[s("td",[t._v("effect:PreferNoSchedule")]),t._v(" "),s("td",[t._v("1.最好不要把非法pod调度上来。2.taints变更，不会驱离非法的pod")])]),t._v(" "),s("tr",[s("td",[t._v("effect:NoExecute")]),t._v(" "),s("td",[t._v("1.不允许非法pod调度上来。2.taints变更，会驱离非法的pod，驱离时间为tolerationSeconds")])])])]),t._v(" "),s("h2",{attrs:{id:"_3-how-to-match"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-how-to-match"}},[t._v("#")]),t._v(" 3.How to match?")]),t._v(" "),s("p",[t._v("无论是"),s("code",[t._v("Taints")]),t._v("还是"),s("code",[t._v("Tolerations")]),t._v("（污点和容忍度），都有三个字段："),s("code",[t._v("key")]),t._v("、"),s("code",[t._v("value")]),t._v("和"),s("code",[t._v("effect")]),t._v("，具体匹配规则如下：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("operator")]),t._v(" "),s("th",[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("Equal")]),t._v(" "),s("td",[t._v("key、value和effect必须都相同")])]),t._v(" "),s("tr",[s("td",[t._v("Exists")]),t._v(" "),s("td",[t._v("key和effect必须相同")])])])]),t._v(" "),s("p",[t._v("需要注意"),s("code",[t._v("operator")]),t._v("没指定的话，默认是"),s("code",[t._v("Equal")])]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('Note:\n有两个特殊用法:\n#Exists：空字段key，会匹配所有的keys, values and effects，意味着容忍所有\ntolerations:\n- operator: "Exists"\n    \n    \n#Exists：空effect，会匹配所有的key: "key"的effect\ntolerations:\n- key: "key"\n  operator: "Exists"\n\n')])])]),s("h2",{attrs:{id:"_4-taint-based-evictions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-taint-based-evictions"}},[t._v("#")]),t._v(" 4.Taint based Evictions")]),t._v(" "),s("p",[t._v("从"),s("code",[t._v("K8S1.6")]),t._v("开始支持了很多封装好的驱离式"),s("code",[t._v("effect")]),t._v("，"),s("code",[t._v("node controller")]),t._v("会根据实际情况，自动给"),s("code",[t._v("node")]),t._v("节点打上对应污点，从而保证了\n"),s("code",[t._v("Pod")]),t._v("调度的合理性和安全性，具体如下所示：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("taint effect")]),t._v(" "),s("th",[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("node.kubernetes.io/not-ready")]),t._v(" "),s("td",[t._v("节点未就绪")])]),t._v(" "),s("tr",[s("td",[t._v("node.kubernetes.io/unreachable")]),t._v(" "),s("td",[t._v("节点不可达")])]),t._v(" "),s("tr",[s("td",[t._v("node.kubernetes.io/out-of-disk")]),t._v(" "),s("td",[t._v("节点地盘耗尽")])]),t._v(" "),s("tr",[s("td",[t._v("node.kubernetes.io/memory-pressure")]),t._v(" "),s("td",[t._v("内存存在压力")])]),t._v(" "),s("tr",[s("td",[t._v("node.kubernetes.io/disk-pressure")]),t._v(" "),s("td",[t._v("磁盘存在压力")])]),t._v(" "),s("tr",[s("td",[t._v("node.kubernetes.io/network-unavailable")]),t._v(" "),s("td",[t._v("网络不可达")])]),t._v(" "),s("tr",[s("td",[t._v("node.kubernetes.io/unschedulable")]),t._v(" "),s("td",[t._v("Node is unschedulable")])]),t._v(" "),s("tr",[s("td",[t._v("node.cloudprovider.kubernetes.io/uninitialized")]),t._v(" "),s("td",[t._v("节点未初始化，不可用")])])])]),t._v(" "),s("h2",{attrs:{id:"_5-常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-常用命令"}},[t._v("#")]),t._v(" 5.常用命令")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("命令")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("kubectl taint -h")]),t._v(" "),s("td",[t._v("taint的帮助命令")])]),t._v(" "),s("tr",[s("td",[t._v("kubectl taint nodes foo dedicated=special-user:NoSchedule")]),t._v(" "),s("td",[t._v("给node打污点，修改需要使用--overwrite=true")])]),t._v(" "),s("tr",[s("td",[t._v("kubectl taint nodes foo dedicated:NoSchedule-")]),t._v(" "),s("td",[t._v("移除taint污点")])])])]),t._v(" "),s("h2",{attrs:{id:"_6-实战操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-实战操作"}},[t._v("#")]),t._v(" 6.实战操作")]),t._v(" "),s("ol",[s("li",[t._v("首先给"),s("code",[t._v("centos-3")]),t._v("这个节点打上污点,"),s("code",[t._v("effect")]),t._v("为"),s("code",[t._v("NoSchedule")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl taint nodes centos-3.shared "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("department")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ops:NoSchedule\n\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("编辑"),s("code",[t._v("filebeat-ds")]),t._v(",并"),s("code",[t._v("apply")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DaemonSet\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" filebeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ds\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" filebeat\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" filebeat\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" filebeat\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" filebeat\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  prima/filebeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("6.4.2\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" REDIS_HOST\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" db.ikubernetes.is"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" LOG_LEVEL\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" info\n\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("发现"),s("code",[t._v("ds")]),t._v("并没有部署到"),s("code",[t._v("centos-3")]),t._v("节点，污点生效，且和预期符合一致")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 chapter12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pod -o wide")]),t._v("\nNAME                     READY   STATUS              RESTARTS   AGE    IP           NODE              NOMINATED NODE   READINESS GATES\nfilebeat-ds-tg7gf        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/1     ContainerCreating   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          3m2s   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("       centos-2.shared   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nngx-new-cb79d555-2c7qq   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running             "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          2d1h   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.7   centos-2.shared   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[s("code",[t._v("delete")]),t._v("之前的"),s("code",[t._v("yaml")]),t._v("，我们重新编辑"),s("code",[t._v("file-ds-tolerations.yaml")]),t._v("（增加容忍度），并"),s("code",[t._v("apply")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DaemonSet\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" filebeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ds\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" filebeat\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" filebeat\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" filebeat\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" filebeat\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  prima/filebeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("6.4.2\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" REDIS_HOST\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" db.ikubernetes.is"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" LOG_LEVEL\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" info\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tolerations")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"department"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Equal"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ops"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("effect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NoSchedule"')]),t._v("\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[t._v("观察"),s("code",[t._v("pod")]),t._v("，发现"),s("code",[t._v("centos-3.shared")]),t._v("已经运行"),s("code",[t._v("pod")]),t._v("，新增的容忍度功能成功")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 chapter12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pod -o wide")]),t._v("\nNAME                     READY   STATUS              RESTARTS   AGE     IP           NODE              NOMINATED NODE   READINESS GATES\nfilebeat-ds-l2png        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/1     ContainerCreating   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          2m43s   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("       centos-2.shared   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nfilebeat-ds-qq2nc        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/1     ContainerCreating   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          2m43s   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("       centos-3.shared   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("ol",{attrs:{start:"6"}},[s("li",[t._v("接下来我们修改"),s("code",[t._v("node3")]),t._v("污点，测试"),s("code",[t._v("Noschedule")]),t._v("策略是否如期一致")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl taint nodes centos-3.shared "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("department")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("test:NoSchedule --overwrite"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\n")])])]),s("ol",{attrs:{start:"7"}},[s("li",[t._v("我们发现"),s("code",[t._v("pod")]),t._v("还是在运行，并不会驱离，和预期一致")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 chapter12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pod -o wide")]),t._v("\nNAME                     READY   STATUS              RESTARTS   AGE     IP           NODE              NOMINATED NODE   READINESS GATES\nfilebeat-ds-l2png        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/1     ContainerCreating   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          5m18s   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("       centos-2.shared   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nfilebeat-ds-qq2nc        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/1     ContainerCreating   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          5m18s   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("       centos-3.shared   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n")])])]),s("ol",{attrs:{start:"8"}},[s("li",[t._v("最后，我们将"),s("code",[t._v("node3")]),t._v("的污点"),s("code",[t._v("effect")]),t._v("修改为"),s("code",[t._v("NoExecute")]),t._v("，观察"),s("code",[t._v("pod")]),t._v("是否被驱离（如果没指定"),s("code",[t._v("tolerationSeconds")]),t._v("，就马上驱离）")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl taint nodes centos-3.shared "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("department")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("test:NoExecute --overwrite"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\n")])])]),s("ol",{attrs:{start:"9"}},[s("li",[t._v("发现"),s("code",[t._v("centos-3.shared")]),t._v("上已经没有"),s("code",[t._v("pod")]),t._v("了，和预期一致")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 chapter12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pod -o wide")]),t._v("\nNAME                     READY   STATUS             RESTARTS   AGE     IP           NODE              NOMINATED NODE   READINESS GATES\nfilebeat-ds-l2png        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/1     ImagePullBackOff   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          7m37s   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.7   centos-2.shared   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n")])])]),s("h2",{attrs:{id:"_7-参考文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-参考文档"}},[t._v("#")]),t._v(" 7.参考文档")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("官方文档：")]),t._v(" "),s("p",[t._v("https://v1-16.docs.kubernetes.io/docs/concepts/configuration/taint-and-toleration/")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);