(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{244:function(t,a,s){"use strict";s.r(a);var e=s(0),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"_1-高级调度说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-高级调度说明"}},[t._v("#")]),t._v(" 1.高级调度说明")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://github-aaron89.oss-cn-beijing.aliyuncs.com/Kubernetes/podaffinity.png",alt:"高级调度"}})]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" with"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("affinity\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("affinity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podAffinity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requiredDuringSchedulingIgnoredDuringExecution")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labelSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchExpressions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" security\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" In\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("values")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" S1\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("topologyKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("domain.beta.kubernetes.io/zone\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podAntiAffinity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("preferredDuringSchedulingIgnoredDuringExecution")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("weight")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podAffinityTerm")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labelSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchExpressions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" security\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" In\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("values")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" S2\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("topologyKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("domain.beta.kubernetes.io/zone\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" with"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("affinity\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" k8s.gcr.io/pause"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.0")]),t._v("\n")])])]),s("p",[t._v("以上是官方的"),s("code",[t._v("demo")]),t._v("和我画的调度图，说明如下：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("首先"),s("code",[t._v("podAffinity")]),t._v("期望必须调度至运行标签是"),s("code",[t._v("security=s1")]),t._v("的"),s("code",[t._v("pod")]),t._v("的节点上，且颗粒度是"),s("code",[t._v("zone")]),t._v("。所以图中"),s("code",[t._v("zone=foo")]),t._v("或者"),s("code",[t._v("zone=bar都")]),t._v("可以。")]),t._v(" "),s("p",[t._v("特别注意：要么都调度至"),s("code",[t._v("zone=foo")]),t._v("，要么都调度至"),s("code",[t._v("zone=bar")]),t._v("中，混合调度就不成立了")])]),t._v(" "),s("li",[s("p",[t._v("然后"),s("code",[t._v("podAntiAffinity")]),t._v("，期望最好不要调度至运行了标签为"),s("code",[t._v("security=S2")]),t._v("的的"),s("code",[t._v("node")]),t._v("节点上（颗粒度为主机）")])]),t._v(" "),s("li",[s("p",[t._v("综上所述，只会调度在"),s("code",[t._v("node-3")]),t._v("或者"),s("code",[t._v("node-7")]),t._v("上面！")])]),t._v(" "),s("li",[s("p",[t._v("补充说明：")]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("pod affinity and anti-affinity的逻辑表达式分为：In, NotIn, Exists, DoesNotExist\n")])])])])]),t._v(" "),s("h2",{attrs:{id:"_2-podaffinity实战"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-podaffinity实战"}},[t._v("#")]),t._v(" 2.PodAffinity实战")]),t._v(" "),s("ol",[s("li",[t._v("环境准备：有一个"),s("code",[t._v("pod")]),t._v("运行在"),s("code",[t._v("centos-2.shared")]),t._v("上，且标签为"),s("code",[t._v("app=ngx-new")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 chapter12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl  get pod -o wide --show-labels")]),t._v("\nNAME                                      READY   STATUS    RESTARTS   AGE     IP           NODE              NOMINATED NODE   READINESS GATES   LABELS\nngx-new-cb79d555-2c7qq                    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          44h     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.7   centos-2.shared   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ngx-new,pod-template-hash"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("cb79d555\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("编辑"),s("code",[t._v("deploy-with-required-podAffinity.yaml")]),t._v(",我们希望这些"),s("code",[t._v("pod")]),t._v("可以调度至有"),s("code",[t._v("app<in>ngx-new")]),t._v("标签的pod的节点上，并且颗粒度是"),s("code",[t._v("zone")]),t._v("的那些节点")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" myapp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("with"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("affinity\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" myapp\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" myapp\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" myapp\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("affinity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podAffinity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requiredDuringSchedulingIgnoredDuringExecution")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#硬亲和，表示希望调度到有app<in>ngx-new标签的pod的节点上，并且颗粒度是zone")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labelSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchExpressions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" In"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("values")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ngx-new"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("topologyKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" zone\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" myapp\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ikubernetes/myapp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v1\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[s("p",[t._v("给2个节点打标签，并且划分不通的"),s("code",[t._v("zone")]),t._v(",预期新"),s("code",[t._v("pod")]),t._v("只会调度至"),s("code",[t._v("centos-2.shared")]),t._v("上")]),t._v(" "),s("p",[t._v("注意：如果"),s("code",[t._v("centos-3.shared")]),t._v("也是"),s("code",[t._v("zone=foo")]),t._v("，新"),s("code",[t._v("pod")]),t._v("也会调度到上面")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl label nodes centos-2.shared "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("zone")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("foo\nkubectl label nodes centos-3.shared "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("zone")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("bar\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[s("code",[t._v("apply")]),t._v("上面的"),s("code",[t._v("deploy-with-required-podAffinity.yaml")]),t._v("，发现新"),s("code",[t._v("pod")]),t._v("都调度至"),s("code",[t._v("centos-2.shared")]),t._v("上了")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 chapter12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl  get pod -o wide --show-labels")]),t._v("\nNAME                                      READY   STATUS    RESTARTS   AGE   IP           NODE              NOMINATED NODE   READINESS GATES   LABELS\nmyapp-with-pod-affinity-778f46bf4-92fxq   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          16m   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.2   centos-2.shared   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("myapp,pod-template-hash"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("778f46bf4\nmyapp-with-pod-affinity-778f46bf4-gwv6z   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          16m   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.3   centos-2.shared   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("myapp,pod-template-hash"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("778f46bf4\nmyapp-with-pod-affinity-778f46bf4-lcvz5   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          16m   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.4   centos-2.shared   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("myapp,pod-template-hash"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("778f46bf4\nngx-new-cb79d555-2c7qq                    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          44h   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.7   centos-2.shared   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ngx-new,pod-template-hash"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("cb79d555\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[t._v("将"),s("code",[t._v("centos-3.shared")]),t._v("的标签也修改为"),s("code",[t._v("zone=bar")]),t._v("，这时候我们"),s("code",[t._v("delete-f")]),t._v("，并重新"),s("code",[t._v("apply")]),t._v(".\n发现"),s("code",[t._v("centos-2.shared")]),t._v("和"),s("code",[t._v("centos-3.shared")]),t._v("都会被调度到，和预期一样")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改 centos-3.shared标签")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 chapter12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl label nodes centos-3.shared zone=foo   --overwrite")]),t._v("\nnode/centos-3.shared labeled\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 chapter12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get node --show-labels")]),t._v("\nNAME              STATUS   ROLES    AGE   VERSION   LABELS\ncentos-1.shared   Ready    master   16d   v1.16.3   beta.kubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("amd64,beta.kubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("linux,kubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("amd64,kubernetes.io/hostname"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("centos-1.shared,kubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("linux,node-role.kubernetes.io/master"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\ncentos-2.shared   Ready    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("   16d   v1.16.3   beta.kubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("amd64,beta.kubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("linux,kubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("amd64,kubernetes.io/hostname"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("centos-2.shared,kubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("linux,zone"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("foo\ncentos-3.shared   Ready    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("   16d   v1.16.3   beta.kubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("amd64,beta.kubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("linux,kubernetes.io/arch"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("amd64,kubernetes.io/hostname"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("centos-3.shared,kubernetes.io/os"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("linux,zone"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("foo\n    \n        \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#重新apply")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 chapter12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f deploy-with-required-podAffinity.yaml ")]),t._v("\ndeployment.apps/myapp-with-pod-affinity created\n    \n        \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#观察pod部署情况       ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos-1 chapter12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl  get pod -o wide --show-labels")]),t._v("\nNAME                                      READY   STATUS    RESTARTS   AGE   IP           NODE              NOMINATED NODE   READINESS GATES   LABELS\nmyapp-with-pod-affinity-778f46bf4-2rqnj   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          34s   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".2.8   centos-3.shared   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("myapp,pod-template-hash"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("778f46bf4\nmyapp-with-pod-affinity-778f46bf4-fjfpr   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          34s   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".2.7   centos-3.shared   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("myapp,pod-template-hash"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("778f46bf4\nmyapp-with-pod-affinity-778f46bf4-tb8v7   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          34s   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.5   centos-2.shared   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("myapp,pod-template-hash"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("778f46bf4\nngx-new-cb79d555-2c7qq                    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          44h   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.7   centos-2.shared   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ngx-new,pod-template-hash"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("cb79d555\n")])])]),s("h2",{attrs:{id:"_3-参考文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-参考文档"}},[t._v("#")]),t._v(" 3.参考文档")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("官方：")]),t._v(" "),s("p",[t._v("https://kubernetes.io/docs/concepts/configuration/assign-pod-node/")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);