(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{240:function(e,t,v){"use strict";v.r(t);var s=v(0),_=Object(s.a)({},(function(){var e=this,t=e.$createElement,v=e._self._c||t;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("h1",{attrs:{id:"kubernetes基础和部署说明"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes基础和部署说明"}},[e._v("#")]),e._v(" Kubernetes基础和部署说明")]),e._v(" "),v("p",[e._v("通过上一章节的学习，想必你对kubernetes已经有了一个较初步的了解，接着本章节将首先就基础组件、集群基础对象和控制器进行详细的介绍和说明，然后辨析集群网络中的三种网络和专有名词，最后关于新手部署测试和生产环境的部署要点进行一些归纳和说明")]),e._v(" "),v("ul",[v("li",[e._v("基础组件")]),e._v(" "),v("li",[e._v("基础对象（Objects）")]),e._v(" "),v("li",[e._v("控制器")]),e._v(" "),v("li",[e._v("集群网络")]),e._v(" "),v("li",[e._v("部署要点")])]),e._v(" "),v("h2",{attrs:{id:"_1-基础组件"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-基础组件"}},[e._v("#")]),e._v(" 1.基础组件")]),e._v(" "),v("p",[v("img",{attrs:{src:"https://github-aaron89.oss-cn-beijing.aliyuncs.com/Kubernetes/kubernetes_components.png",alt:"基础组件"}})]),e._v(" "),v("p",[e._v("如图所示，kubernetes集群中主要分为三个组件：")]),e._v(" "),v("h3",{attrs:{id:"_1-master-components"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-master-components"}},[e._v("#")]),e._v(" 1.Master Components")]),e._v(" "),v("ul",[v("li",[e._v("kube-apiserver：作为k8s控制平面的前端，也是所有请求接收的入口")]),e._v(" "),v("li",[e._v("etcd：k8s集群后端所有集群数据的高可用k/v存储数据库")]),e._v(" "),v("li",[e._v("kube-scheduler：监听变更请求，然后通过一系列"),v("code",[e._v("filtering")]),e._v("、"),v("code",[e._v("scoring")]),e._v("策略，调度pod运行")]),e._v(" "),v("li",[e._v("kube-controller-manager：一个独立的进程，通过合解循环，将期望态和运行态保持一致")]),e._v(" "),v("li",[e._v("cloud-controller-manager："),v("code",[e._v("kubernetes")]),e._v("与云厂商提供的服务能力对接的关键组件。又称"),v("code",[e._v("kubernetes cloudprovider")]),e._v("。 通过这个组件，可以让用户在创建"),v("code",[e._v("k8s LoadBalancer")]),e._v(" 类型的"),v("code",[e._v("service")]),e._v("的时候自动的为用户创建一个阿里云"),v("code",[e._v("SLB")]),e._v("，同时动态的绑定与解绑SLB后端，并且提供了丰富的配置允许用户自定义生成的"),v("code",[e._v("LoadBalancer")]),e._v("。")])]),e._v(" "),v("h3",{attrs:{id:"_2-node-components"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-node-components"}},[e._v("#")]),e._v(" 2.Node Components")]),e._v(" "),v("ul",[v("li",[e._v("kubelet：每个"),v("code",[e._v("node")]),e._v("节点的"),v("code",[e._v("k8s")]),e._v("客户端，用于确保"),v("code",[e._v("pod")]),e._v("的运行")]),e._v(" "),v("li",[e._v("kube-proxy：确保"),v("code",[e._v("k8s")]),e._v("服务间连接和转发的组件")]),e._v(" "),v("li",[e._v("Container Runtime：运行容器的软件，常见的有："),v("code",[e._v("Docker")]),e._v(", "),v("code",[e._v("rkt")]),e._v("等")])]),e._v(" "),v("h3",{attrs:{id:"_3-addons-附加组件"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-addons-附加组件"}},[e._v("#")]),e._v(" 3.Addons(附加组件)")]),e._v(" "),v("ul",[v("li",[e._v("DNS： 常用的有CoreDNS")]),e._v(" "),v("li",[e._v("CNI (flannel, calico, ...)     #网络插件接口，我们后面会讲")]),e._v(" "),v("li",[e._v("Web UI (Dashboard)")]),e._v(" "),v("li",[e._v("Container Resource Monitoring")]),e._v(" "),v("li",[e._v("Cluster-level Logging")]),e._v(" "),v("li",[e._v("...")])]),e._v(" "),v("h2",{attrs:{id:"_2-基础对象（objects）"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-基础对象（objects）"}},[e._v("#")]),e._v(" 2.基础对象（Objects）")]),e._v(" "),v("p",[e._v("除了上面提到的基础组件之外，"),v("code",[e._v("kubernetes")]),e._v("还提供了丰富的基础对象（"),v("code",[e._v("Objects")]),e._v("），如：")]),e._v(" "),v("div",{staticClass:"language-text extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[e._v("Pod、service、NameSpace和Volume\n")])])]),v("p",[v("img",{attrs:{src:"https://github-aaron89.oss-cn-beijing.aliyuncs.com/Kubernetes/k8s-basicobjects.png",alt:"集群对象"}})]),e._v(" "),v("p",[e._v("这是一张传统架构tomcat请求redis集群于kubernetes集群中的新架构。\n如图可知，")]),e._v(" "),v("blockquote",[v("p",[e._v("外部流量首先访问tomcat service，tomcat service再将流量分发至相关的tomcat pod上面，接着，tomcat pod也不是直接访问相关redis pod，而是同理，只访问redis server，redis server负责后续流量的转发。如果你了解eureka，想必你对这张图的理解是很快的。")])]),e._v(" "),v("p",[e._v("接着，我们来看一下几个基础对象组件：")]),e._v(" "),v("ul",[v("li",[e._v("Pod：你可以理解为一组docker容器的集合，如redis pod、tomcat pod")]),e._v(" "),v("li",[e._v("service：类似于eureka，负责下游服务的动态发现、注册和续约")]),e._v(" "),v("li",[e._v("volume：就是个存储卷，其支持很多类型的存储系统")]),e._v(" "),v("li",[e._v("pod controller：负责pod数量的变更通知和执行，和service相互协作，达到动态的特性")])]),e._v(" "),v("h2",{attrs:{id:"_3-控制器"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-控制器"}},[e._v("#")]),e._v(" 3.控制器")]),e._v(" "),v("p",[v("img",{attrs:{src:"https://github-aaron89.oss-cn-beijing.aliyuncs.com/Kubernetes/k8s-controllers.png",alt:"控制器"}})]),e._v(" "),v("p",[e._v("另外，"),v("code",[e._v("kubernetes")]),e._v("还包含了更高一层的抽象，称之为控制器（"),v("code",[e._v("Controllers")]),e._v("）。\n控制器建立在基础对象之上，并提供了额外、丰富且方便的功能，他们包括：")]),e._v(" "),v("div",{staticClass:"language-text extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[e._v("ReplicaSet、Deployment、DaemonSet、StatefulSet、Job等\n")])])]),v("p",[e._v("注意：")]),e._v(" "),v("blockquote",[v("p",[e._v("这里你只需要先有一个基础概念的了解，对于每个控制器的区别和应用场景，我们后续的章节会逐个讲解。")])]),e._v(" "),v("h2",{attrs:{id:"_4-集群网络"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-集群网络"}},[e._v("#")]),e._v(" 4.集群网络")]),e._v(" "),v("p",[e._v("如上图所示，"),v("code",[e._v("kubernetes")]),e._v("集群可分为三种网络：节点网络、Pod网络和"),v("code",[e._v("Service")]),e._v("网路。")]),e._v(" "),v("div",{staticClass:"language-text extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[e._v("node ip：\n    配置在节点的网卡上\n    \npod ip：\n    配置在容器的虚拟网卡上\n    \nservice ip（cluster ip）：\n    不进行配置，只存在于iptables和DNS的解析记录中\n")])])]),v("h2",{attrs:{id:"_5-部署要点"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_5-部署要点"}},[e._v("#")]),e._v(" 5.部署要点")]),e._v(" "),v("p",[e._v("测试环境：")]),e._v(" "),v("blockquote",[v("p",[e._v("可以使用单Master节点，单etcd实例；Node节点按需配置；存储直接使用Nfs或glusterfs")])]),e._v(" "),v("p",[e._v("生产环境：")]),e._v(" "),v("blockquote",[v("p",[e._v("1.高可用etcd集群（需定期备份etcd数据文件），建立3、5或7个节点，保证一定的冗余能力；")])]),e._v(" "),v("blockquote",[v("p",[e._v("2.Master节点要保证高可用：kube-apiserver是无状态的，可多实例部署，并借助于Haproxy、nginx或keepalived进行vip流量实现多实例冗余；")])]),e._v(" "),v("blockquote",[v("p",[e._v("3.Master节点要保证高可用：kuber-scheduler和kuber-controller-manager组件只能有一个活动实例，但可以有多个备用（主备模式）；")])]),e._v(" "),v("blockquote",[v("p",[e._v("4.Node节点：数量越多，冗余和负载能力就越强;")])]),e._v(" "),v("blockquote",[v("p",[e._v("5.集群存储建议采用Ceph、glusterfs、iSCSI、FC SAN及各种云存储等。")])])])}),[],!1,null,null,null);t.default=_.exports}}]);