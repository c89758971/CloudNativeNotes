(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{249:function(s,a,t){"use strict";t.r(a);var e=t(0),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"helm使用进阶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm使用进阶"}},[s._v("#")]),s._v(" Helm使用进阶")]),s._v(" "),t("p",[t("code",[s._v("Helm")]),s._v("是一种管理"),t("code",[s._v("Charts")]),s._v("的工具，而"),t("code",[s._v("charts")]),s._v("则是打包预配置"),t("code",[s._v("Kubernetes")]),s._v("基础资源的配置")]),s._v(" "),t("ul",[t("li",[s._v("自定义chart制作")]),s._v(" "),t("li",[s._v("release迭代")]),s._v(" "),t("li",[s._v("release回滚")]),s._v(" "),t("li",[s._v("自定义chart打包并发布")]),s._v(" "),t("li",[s._v("命令补全")])]),s._v(" "),t("h2",{attrs:{id:"_1-自定义chart制作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-自定义chart制作"}},[s._v("#")]),s._v(" 1.自定义chart制作")]),s._v(" "),t("ol",[t("li",[s._v("首先我们先创建我们的"),t("code",[s._v("myapp")]),s._v("的"),t("code",[s._v("chart")]),s._v("项目")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入local仓库的目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos-1 local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /root/.helm/repository/local")]),s._v("\n    \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创myapp项目    ")]),s._v("\n$ helm create mongodb\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos-1 local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n├── index.yaml\n└── myapp\n    ├── charts\n    ├── Chart.yaml\n    ├── templates\n    │   ├── deployment.yaml\n    │   ├── _helpers.tpl\n    │   ├── ingress.yaml\n    │   ├── NOTES.txt\n    │   └── service.yaml\n    └── values.yaml\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("按需修改"),t("code",[s._v("Chart.yaml")]),s._v("、"),t("code",[s._v("values.yaml")])])]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Chart.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("appVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.3"')]),s._v("                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pod版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myapp web service\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myapp\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 0.1.0          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#release版本")]),s._v("\n    \n    \n    \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#values.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Default values for myapp.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This is a YAML-formatted file.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Declare variables to be passed into your templates.")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicaCount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ikubernetes/myapp\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tag")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pullPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterIP\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ingress")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubernetes.io/ingress.class: nginx")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# kubernetes.io/tls-acme: "true"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" chart"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("example.local\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  - secretName: chart-example-tls")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    hosts:")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      - chart-example.local")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# We usually recommend not to specify default resources and to leave this as a conscious")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# choice for the user. This also increases chances charts run on environments with little")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# resources, such as Minikube. If you do want to specify resources, uncomment the following")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lines, adjust them as necessary, and remove the curly braces after 'resources:'.")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("limits")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 100m\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 128Mi\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 100m\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 128Mi\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeSelector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tolerations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("affinity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("    \n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("使用"),t("code",[s._v("lint")]),s._v("进行项目的语法检查")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos-1 local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm  lint myapp")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Linting myapp\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Chart.yaml: icon is recommended\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" chart"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" linted, no failures\n")])])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("本地"),t("code",[s._v("myapp")]),s._v("项目发布，可以使用"),t("code",[s._v("--dry-run")]),s._v("进行检测,也可以使用"),t("code",[s._v("set")]),s._v("命令进行临时传参")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos-1 local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm install -n myapp ./myapp/ --set service.type=NodePort --dry-run")]),s._v("\nNAME:   myapp\n    \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos-1 local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm install -n myapp ./myapp/ --set service.type=NodePort ")]),s._v("\nNAME:   myapp\nLAST DEPLOYED: Tue Dec "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":35:10 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\nNAMESPACE: default\nSTATUS: DEPLOYED\n    \nRESOURCES:\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" v1/Deployment\nNAME   READY  UP-TO-DATE  AVAILABLE  AGE\nmyapp  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("invalid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    \n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" v1/Pod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("related"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nNAME                    READY  STATUS             RESTARTS  AGE\nmyapp-78cfb4645b-2q65q  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1    ContainerCreating  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("invalid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    \n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" v1/Service\nNAME   TYPE      CLUSTER-IP      EXTERNAL-IP  PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       AGE\nmyapp  NodePort  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.103")]),s._v(".135.152  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":32441/TCP  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("invalid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    \n    \nNOTES:\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". Get the application URL by running these commands:\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get --namespace default -o "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.spec.ports[0].nodePort}"')]),s._v(" services myapp"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_IP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get nodes --namespace default -o "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.items[0].status.addresses[0].address}"')]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" http://"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_IP")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_PORT")]),s._v("\n")])])]),t("ol",{attrs:{start:"5"}},[t("li",[s._v("查看"),t("code",[s._v("release")]),s._v("发布情况，发现发布成功了")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos-1 local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm list")]),s._v("\nNAME \tREVISION\tUPDATED                 \tSTATUS  \tCHART      \tNAMESPACE\nmyapp\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       \tTue Dec "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":35:10 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\tDEPLOYED\tmyapp-0.1.0\tdefault  \n\n")])])]),t("h2",{attrs:{id:"_2-release迭代"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-release迭代"}},[s._v("#")]),s._v(" 2.release迭代")]),s._v(" "),t("ol",[t("li",[s._v("修改"),t("code",[s._v("Chart.yaml")]),s._v("和"),t("code",[s._v("values.yaml")])])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Chart.yaml")]),s._v("\napiVersion: v1\nappVersion: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.4"')]),s._v("                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pod版本")]),s._v("\ndescription: myapp web "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\nname: myapp\nversion: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(".1          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#release版本")]),s._v("\n    \n        \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#values.yaml")]),s._v("\nreplicaCount: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\nimage:\n  repository: ikubernetes/myapp\n  tag: v4                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改镜像tag")]),s._v("\n  pullPolicy: IfNotPresent\n\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("使用"),t("code",[s._v("upgrade")]),s._v("命令升级"),t("code",[s._v("release")])])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos-1 local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm upgrade myapp ./myapp --set service.type=NodePort")]),s._v("\nRelease "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myapp"')]),s._v(" has been upgraded. Happy Helming"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\nLAST DEPLOYED: Tue Dec "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":41:29 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\nNAMESPACE: default\nSTATUS: DEPLOYED\n    \nRESOURCES:\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" v1/Deployment\nNAME   READY  UP-TO-DATE  AVAILABLE  AGE\nmyapp  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          6m15s\n    \n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" v1/Pod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("related"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nNAME                    READY  STATUS             RESTARTS  AGE\nmyapp-5c8b9d645f-jjp6c  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1    ContainerCreating  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         0s\nmyapp-78cfb4645b-2q65q  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1    Running            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         6m15s\n    \n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" v1/Service\nNAME   TYPE      CLUSTER-IP      EXTERNAL-IP  PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       AGE\nmyapp  NodePort  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.103")]),s._v(".135.152  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":32441/TCP  6m15s\n    \n    \nNOTES:\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". Get the application URL by running these commands:\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get --namespace default -o "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.spec.ports[0].nodePort}"')]),s._v(" services myapp"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_IP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get nodes --namespace default -o "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.items[0].status.addresses[0].address}"')]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" http://"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_IP")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_PORT")]),s._v("\n\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("发现"),t("code",[s._v("CHART")]),s._v("已经成功更新至"),t("code",[s._v("myapp-0.1.1")]),s._v("版本，同时"),t("code",[s._v("REVISION=2")])])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos-1 local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm list ")]),s._v("\nNAME \tREVISION\tUPDATED                 \tSTATUS  \tCHART      \tNAMESPACE\nmyapp\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("       \tTue Dec "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":41:29 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\tDEPLOYED\tmyapp-0.1.1\tdefault  \n\n")])])]),t("h2",{attrs:{id:"_3-release回滚"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-release回滚"}},[s._v("#")]),s._v(" 3.release回滚")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("使用"),t("code",[s._v("rollback")]),s._v("命令进行回滚，回滚到版本1。")]),s._v(" "),t("p",[s._v("注意：rollback命令需要两个位置参数：release name, revision number")])])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos-1 local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm rollback myapp 1")]),s._v("\nRollback was a success"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" Happy Helming"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("回滚成功，"),t("code",[s._v("CHART")]),s._v("为"),t("code",[s._v("myapp-0.1.0")]),s._v("，此时"),t("code",[s._v("REVISION=3")]),s._v("（递增的版本号）")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos-1 local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm list ")]),s._v("\nNAME \tREVISION\tUPDATED                 \tSTATUS  \tCHART      \tNAMESPACE\nmyapp\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("       \tTue Dec "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":46:12 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\tDEPLOYED\tmyapp-0.1.0\tdefault  \n\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("查看项目情况")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos-1 local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm status myapp")]),s._v("\nLAST DEPLOYED: Tue Dec "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":46:12 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\nNAMESPACE: default\nSTATUS: DEPLOYED\n    \nRESOURCES:\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" v1/Deployment\nNAME   READY  UP-TO-DATE  AVAILABLE  AGE\nmyapp  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          14m\n    \n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" v1/Pod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("related"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nNAME                    READY  STATUS   RESTARTS  AGE\nmyapp-78cfb4645b-zj9pv  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1    Running  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         3m34s\n    \n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" v1/Service\nNAME   TYPE      CLUSTER-IP      EXTERNAL-IP  PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       AGE\nmyapp  NodePort  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.103")]),s._v(".135.152  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":32441/TCP  14m\n    \n    \nNOTES:\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". Get the application URL by running these commands:\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get --namespace default -o "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.spec.ports[0].nodePort}"')]),s._v(" services myapp"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_IP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get nodes --namespace default -o "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.items[0].status.addresses[0].address}"')]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" http://"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_IP")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_PORT")]),s._v("\n\n")])])]),t("h2",{attrs:{id:"_4-自定义chart打包并发布"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-自定义chart打包并发布"}},[s._v("#")]),s._v(" 4.自定义chart打包并发布")]),s._v(" "),t("ol",[t("li",[s._v("使用"),t("code",[s._v("package")]),s._v("打包"),t("code",[s._v("myapp")]),s._v("项目")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos-1 local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm package ./myapp/")]),s._v("\nSuccessfully packaged chart and saved it to: /root/.helm/repository/local/myapp-0.1.1.tgz\n\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("创建项目存放路径，并把打包好的项目丢过去")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /data/repo\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" myapp /data/repo\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("使用"),t("code",[s._v("serve")]),s._v("启动"),t("code",[s._v("local")]),s._v("仓库")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos-1 local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm serve --repo-path /data/repo --url /charts")]),s._v("\nRegenerating index. This may take a moment.\nNow serving you on "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:8879\n")])])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("这时，我们就可以在"),t("code",[s._v("local")]),s._v("仓库找到我们打包的项目了")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centos-1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm search local ")]),s._v("\nNAME                   \tCHART VERSION\tAPP VERSION\tDESCRIPTION                                       \nlocal/myapp            \t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(".1        \t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.4")]),s._v("        \tmyapp web "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("                                 \nstable/magic-ip-address\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(".0        \t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.9")]),s._v(".0      \tA Helm chart to assign static IP addresses "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n")])])]),t("h2",{attrs:{id:"_5-命令补全"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-命令补全"}},[s._v("#")]),s._v(" 5.命令补全")]),s._v(" "),t("p",[s._v("注意：\n"),t("code",[s._v("helm")]),s._v("命令自动补全功能设置，可使用以下命令:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("helm completion "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);